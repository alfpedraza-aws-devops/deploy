---
# Run the pipeline build.

- name: Start the Jenkins service so the build can run
  service:
    name: jenkins
    enabled: yes
    state: started

- name: Wait until the Jenkins service is available
  uri:
    url: "http://localhost:8080/"
    return_content: yes
    status_code: [200, 404]
  register: jenkins_wait
  until: jenkins_wait.status == 200 and jenkins_wait.content.find('Please wait while Jenkins is getting ready to work') == -1
  retries: 10
  delay: 5

- name: Run the pipeline build
  uri:
    method: "POST"
    url: "http://localhost:8080/job/{{ jenkins_job_name }}/build"
    status_code: [201]